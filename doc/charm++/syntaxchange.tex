\section{Syntax Changes from \charmpp\ 4.9}

The following changes are required to make older \charmpp\ 4.9
programs run with the new translator and runtime system in
\charmpp\ 5.0.

\begin{itemize}

\item Replace all references to {\tt *.top.h} and {\tt *.bot.h} to
{\tt *.decl.h} and {\tt *.def.h} respectively. This should be done in
Makefile, and everywhere these two types of files are included.

\item Change all X.ci files to include a top-level enclosure of module X {...}.

\item Change \kw{chare} \uw{main} to \kw{mainchare} \uw{main}.

\item Replace \kw{chare\_object} by \kw{Chare}.

\item Replace \kw{groupmember} by \kw{Group}.

\item Replace \kw{comm\_object} by \uw{CMessage\_<msgName>} in all
message declarations in {\tt *.h} files. 

\item Remove all \kw{operator new} methods of messages.

\item Remove \kw{MsgIndex(..)} parameter to \kw{new} for message allocation.

\item Remove all the empty messages (used only for triggering
computations.) from {\tt *.h}, {\tt *.ci}, {\tt *.C} files. All the
entry methods that take these empty messages as parameters should be
made methods with \kw{void} parameter. This should be done in all {\tt
*.ci}, {\tt *.h}, and {\tt *.C} files.  In these methods, there may be
a {\tt delete msg}. Remove that. 

\item Check for \kw{mainhandle} in the source. If it is there, declare
it as a \kw{readonly} variable in {\tt .ci} file, and initialize it in
the \kw{mainchare}'s constructor, so that it is available to all the
processors during the run.

\item All the \kw{packmessage} declarations in {\tt *.ci} files should
be changed to \kw{message [packed]}. 

\item All \kw{CPrintf}, \kw{CScanf}, and \kw{CError} should be changed
to \kw{CkPrintf}, \kw{CkScanf}, and \kw{CkError}. 

\item All \kw{CharmExit} should be changed to \kw{CkExit}.

\item Replace \kw{CMyPe} by \kw{CkMyPe}. Replace \kw{CNumPes} by \kw{CkNumPes}.

\item Change \kw{ChareIDType} to \kw{CkChareID}.

\item Change signature of \uw{M::pack} and \uw{M::unpack} for all
messages \uw{M} in {\tt *.h}, {\tt *.C} to\\
\verb+static void *pack(M* msg)+\\
and\\
\verb+static M* unpack(void *buf)+\\
and change the code
accordingly. This is a significant change because {\tt pack} and {\tt unpack}
used to be instance methods, and now they are class static
methods.  Avenues of optimizations open with this change, but one need
not explore those in the interest of time immediately. Further, one
should make sure that the performance of the new scheme is at least as
good as the old one. 

\item Replace all \kw{new\_group} by \uw{CProxy\_<grpName>::ckNew}.

\item Replace \kw{new\_chare2} by proxy creation.

\item Replace \kw{CSendMsg} by temporary proxy creation based on
ChareID and invoking appropriate method on it. One optimization is to
create a proxy immediately after a ChareID is received, and reusing it
everytime.

\item Similarly replace \kw{CSendMsgBranch} by temporary proxy
creation based on the groupID, and invoking appropriate method on it,
with processor number as the second parameter. Once again, there is an
opportunity for optimization here. 

\item Similarly replace \kw{CBroadcastMsgBranch} by temporary proxy
creation based on the groupID, and invoking appropriate method on it,
without any second parameter. Once again, there is an opportunity for
optimization here. 

\item Replace \kw{CStartQuiescence} by \kw{CkStartQD}.

\item Replace \kw{GetEntryPtr} by appropriate static method
(\kw{ckIdx\_*}) calls. 

\item Replace \kw{CLocalBranch} macros by \kw{ckLocalBranch} instance
method on temporarily created proxy. 

\item Change \kw{CPriorityPtr} to \kw{CkPriorityPtr}, also cast it
explicitly to {\tt (int *)}. 

\item Replace \kw{QuiescenceMessage} by \kw{CkQDMsg}. Remove all
extern declarations of \kw{CkQDMsg} from {\tt *.ci} files.

\end{itemize}
