%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RCS INFORMATION:
%
%       $RCSfile$
%       $Author$        $Locker$           $State$
%       $Revision$      $Date$
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DESCRIPTION:
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% REVISION HISTORY:
%
% $Log$
% Revision 1.11  1998-11-03 19:24:48  milind
% Added documentation for the new shell option in nodelist.
%
% Revision 1.10  1997/07/25 21:07:54  wilmarth
% Made a few more nodes file changes.
%
% Revision 1.9  1997/07/23 17:29:14  wilmarth
% Updated with latest nodes file format.
%
% Revision 1.8  1996/11/14 18:41:14  milind
% Modified to reflect the changes made to the nodesfile format.
% Also, changed the Makefile to install into proper directories.
%
% Revision 1.7  1995/11/20 20:14:22  brunner
% Made the comments about simulator and Converse more sensible.
%
% Revision 1.6  1995/11/20  16:47:00  brunner
% Added comments about simulator only working for Charm/Charm++
%
% Revision 1.5  1995/11/17  17:19:37  brunner
% Incorporated proofreading comments from 11-16 afternoon
%
% Revision 1.4  1995/11/16  23:59:02  brunner
% incorporated Attila's simulator section
%
% Revision 1.3  1995/11/16  20:58:57  brunner
% Added some paragon information
%
% Revision 1.2  1995/11/16  19:05:03  milind
% *** empty log message ***
%
% Revision 1.1  1995/10/31  22:27:53  milind
% Initial revision
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section[Executing Converse/Charm/Charm++ Programs]
	{Executing Converse/Charm/Charm++ Programs}
\label{executing charm programs}

The Charm linker produces one executable file.  On machines with a host
(such as a network of workstations), a link to the proper host program
{\fexec conv-host} is created in the user program directory.  Sample
execution examples are given below (the executable is called {\fparm
pgm}). Exact details will differ from site to site.  The list of Charm
command line options is in Section~\ref{command line options}.

\begin{itemize}

\item \underline{\bf CM-5:} 
	\begin{tabbing}
	{\fexec pgm}
	\end{tabbing}
	will run program {\fparm pgm} interactively from one of the partition 
	managers.  For programs with large resource requirements, use the utilities
	{\fexec jrun} and {\fexec jstat}. See the man pages at your site for
	more information. Also, the {\fexec +pN} option is recognized and runs {\fexec pgm} on {\fexec N} processors.

\item \underline{\bf nCUBE/2:} 
	\begin{tabbing}
	{\fexec xnc -d4 pgm}
	\end{tabbing}
	runs {\fparm pgm} on a hypercube of dimension 4 (i.e. on 16 processors). 

\item \underline{\bf Paragon running SunMos:} 
	\begin{tabbing}
	{\fexec yod -sz 4 pgm}
	\end{tabbing}
	runs {\fparm pgm} on four processors.

\item \underline{\bf Paragon running OSF:} 
	\begin{tabbing}
	{\fexec pexec pgm -sz 4}
	\end{tabbing}
	runs {\fparm pgm} on four processors.

\item \underline{\bf Network of workstations:} 
	\begin{tabbing}
	{\fexec conv-host pgm +p4}
	\end{tabbing}
	executes {\fparm pgm} on 4 nodes.  In a network environment, Charm must
	be able to locate the directory of the executable.  If all workstations
	share a common file name space this is trivial.  If they don't, Charm
	will attempt to find the executable in a directory with the same path
	from the {\bf \$HOME} directory.  Pathname resolution is performed as 
	follows:
	\begin{enumerate}
		\item The system computes the absolute path of {\fexec pgm}.
		\item If the absolute path starts with the equivalent of {\bf \$HOME} 
			or the current working directory, the beginning part of the path 
			is replaced with the environment variable {\bf \$HOME} or the 
			current working directory. However, if {\fparm exec\_home} is 
            specified in the nodes file (see below), the beginning part of
            the path is replaced with {\fparm exec\_home}.
		\item The system tries to locate this program (with modified 
			pathname and appended extension if specified) on all nodes.
	\end{enumerate}

The list of nodes must be specified in a file.  The format of this file
allows you to define groups of machines, giving each group a name.
Each line of the nodes file is a command.  The most important command
is:

\begin{verbatim}
host <hostname>
\end{verbatim}

which specifies a host.  The other commands are qualifiers: they modify
the properties of all hosts that follow them.  The qualifiers are:


\begin{tabbing}
{\tt group <groupname>}~~~\= - subsequent hosts are members of specified group\\
{\tt login <login>  }     \> - subsequent hosts use the specified login\\
{\tt shell <shell>  }     \> - subsequent hosts use the specified remote 
shell\\
%{\tt passwd <passwd>}     \> - subsequent hosts use the specified password\\
{\tt setup <cmd>  }       \> - subsequent hosts should execute cmd\\
{\tt home <dir> }         \> - subsequent hosts should find programs under dir\\
{\tt cpus <n>}            \> - subsequent hosts should use N light-weight processes\\
{\tt speed <s>}           \> - subsequent hosts have relative speed rating\\
{\tt ext <extn>}          \> - subsequent hosts should append extn to the pgm name\\
\end{tabbing}

{\bf Note:}
 By default, conv-host uses a remote shell "rsh" to spawn node processes
on the remote hosts. The {\tt shell} qualifier can be used to override
it with say, "ssh". One can set the {\tt CONV\_RSH} environment variable
or use conv-host option {\tt ++remote-shell} to override the default remote 
shell for all hosts with unspecified {\tt shell} qualifier.

All qualifiers accept "*" as an argument, this resets the modifier to
its default value.  Note that currently, the passwd, cpus, and speed
factors are ignored.  Inline qualifiers will be added:

\begin{verbatim}
host beauty ++cpus 2
\end{verbatim}

and also user-defined qualifiers.

Here is a simple nodes file:

\begin{verbatim}
        group kale-sun
         
        host charm.cs.uiuc.edu
        host dp.cs.uiuc.edu
        host grace.cs.uiuc.edu
        host dagger.cs.uiuc.edu
         
        group kale-sol
         
        host beauty.cs.uiuc.edu
         
        group main
         
        host localhost
\end{verbatim}

This defines three groups of machines: group kale-sun, group kale-sol,
and group main.  The ++nodegroup option is used to specify which group
of machines to use.  Note that there is wraparound: if you specify
more nodes than there are hosts in the group, it will reuse
hosts. Thus,

\begin{verbatim}
        conv-host pgm ++nodegroup kale-sun +p6
\end{verbatim}

uses hosts (charm, dp, grace, dagger, charm, dp) respectively as
nodes (0, 1, 2, 3, 4, 5).

If you don't specify a ++nodegroup, the default is ++nodegroup main.
Thus, if one specifies

\begin{verbatim}
        conv-host pgm +p4
\end{verbatim}

it will use ``localhost'' four times.  ``localhost'' is a Unix
trick; it always find a name for whatever machine you're on.

Since the new nodes file is incompatible with the old nodes file, it has
been renamed.  It now is called ``.nodelist'', and all the options and
environment variables pertaining to it have also been renamed {\tt nodelist}.

%%
%The list of nodes must be specified in a file, with one node entry per
%line, each entry being in the format:
%
%{\fexec nodename [username] [passwd] [exec\_home] [extension] [setup\_command]}
%
%The {\fparm nodename} must be specified completely (e.g. sparc1.cs.uiuc.edu).
%The {\fparm username} is optional; if the login id on that node is the
%same as the current login id, it need not be specified.
%The {\fparm password} argument is ignored in the current implementation.
%The {\fparm exec\_home} argument is optional; if the directory path under
%which the executable is found is the same as on the node running 
%{\fexec conv-host}, it could be ignored. This argument is used for pathname
%resolution as explained above.
%The {\fparm extension} argument is useful when the names for executables 
%on each node differ. If specified, {\fexec conv-host}
%appends the extension to the name of the executable specified on the 
%command line and executes the new program.
%The {\fparm setup\_command} is optional; if specified,
%the command is executed on the corresponding node before the program 
%begins execution. The {\bf *} character may be used as a
%placeholder for an absent argument.
%The number of nodes specified in the nodes file must not be less
%than the number of nodes specified with the {\fexec +p} command
%line option. If the number of nodes specified in the nodes file is
%greater than the number of nodes specified with the {\fexec +p} option,
%{\fexec +p} entries in the nodes file will be used in succession, starting
%with the first entry in the file.
%The name of the nodes file\index{nodes file}\index{.nodes} itself is
%obtained by  {\fexec conv-host} in the following order:
%\begin{enumerate}
%
%\item	From the command line option {\fexec ++nodesfile}.
%
%\item	If the {\fexec ++nodesfile} option is not given, the value of the 
%environment variable {\fexec NODES} is taken to be the nodes file.
%
%\item	If the environment variable {\fexec NODES} is not set, the file 
%{\fparm .nodelist}\index{.nodelist}\index{nodes file} in the user's home
%directory is taken to be the nodes file.
%
%\item	If the above file does not exist, the file 
%{\fparm .nodelist}\index{.nodelist}\index{nodes file} in the current
%directory is used as the nodes file.
%
%\end{enumerate}

The user is required to set up remote login permissions on all nodes
using the .rhosts file in the home directory.

\end{itemize}

Note that the Charm linker will provide the correct 
executable. The user, however, needs to know how programs are run for
the particular machine.

\subsection[Running with the simulator]{Running with the simulator}

Converse provides a simple parallel machine simulator for developing
and debugging purposes.  It simulates a message passing system
composed of a collection of processing nodes connected with a
communication network. Each node is composed of an application
processor, local memory, and a communication coprocessor.  The
simulator is a beta version, and it is not yet proven that the
simulator timers for performance measurements produce realistic
results.


In order to run Charm and Charm++ programs with the simulator:
\begin{itemize}

\item link user program with \verb+<machine>/lib/libck-unimain.o+

\item prepare a configuration file as described below

\item to run, type \verb#pgm +pN# (and possibly other runtime options) where
   N is the number of processors.

\end{itemize}
Currently only Charm and Charm++ programs can take advantage of the
simulator features, because the \verb+libck-unimain.o+ file is Charm
specific.  In the future, a method to allow any Converse based program
to use the simulator features will be devised.

The basic task of the simulator is to manage the message passing
obeying various machine and network parameters.  A message experiences
delays in various components of the machine. These include: 1) sender
application processor, 2) sender communication coprocesssor, 3)
network, 4) receiver communication processor, and 5) receiver
application processor.  Each component of the delayed is modelled by
the widely used formula $\alpha + n\beta$ where $\alpha$ is the
startup cost, and $\beta$ is the cost per byte.  In addition to
message delay parameters, there are others related to the network
capacity and random variations in network delays. These parameters are
specified in a configuration file named "sim.param" in the directory
of the user program. If the simulator can't find this file, it assumes
default values (mostly zero latencies).  Figure~\ref{fig:simconfig}
lists a sample configuration. The lines starting with the \# sign are
treated as comments. Each line contains a keyword followed by some
numbers. The explanation of each keyword is given below:

\begin{description}

\item[{\tt cpu\_recv\_cost}] $\alpha$ and  $\beta$ values  for the software
                            cost of a message-receive at the application
                            processor.

\item[{\tt cpu\_send\_cost}] $\alpha$ and  $\beta$ values  for the software
                            cost of a message-send at the application
                            processor.

\item[{\tt rcp\_cost}] $\alpha$ and  $\beta$ values for a message-receive 
                       at the communication processor.

\item[{\tt scp\_cost}] $\alpha$ and  $\beta$ values for a message-send
                       at the communication processor.

\item[{\tt net\_cost}] $\alpha$ and  $\beta$ values for a message-send
                       in the netowrk.

\item[{\tt cpu\_queue\_threshold\_number}] max number of messages queued
                       at the application processors's incoming message queue.

\item[{\tt cpu\_queue\_threshold\_size}] max cumulative size of
		       messages in bytes queued at the application
		       processors's incoming message queue.


\item[{\tt cpu\_queue\_threshold\_number}] max number of messages in the incoming
                       message queue of communication processor.


\item[{\tt rcp\_queue\_threshold\_number}] max number of messages in the 
                       incoming-message-queue of communication processors.                    
\item[{\tt rcp\_queue\_threshold\_size}] max cumulative size of messages in bytes
                       in the incoming-message-queue of communication 
                       processors.

\item[{\tt net\_queue\_threshold\_number}] max number of transient messages in 
                       the network.

\item[{\tt net\_queue\_threshold\_size}] max cumulative size of transient 
                       messages in bytes in the network.

\item[{\tt latency-fixed}] no random variations in the network latency 
                           ($\alpha$)

\item[{\tt latency-rand}] network latency ($\alpha$) is incremented by
                       a random value distributed exponentially. The first
                       number after the keyword is the mean of the
                       exponential distribution. The second number is the
                       initial seed vbalue for the random number generator.


\item[{\tt processor\_scale}] The simulator scales the measured time
                      execution of code-blocks by this value.

\item[{\tt periodic\_interval}] Converse has periodic checks for
                      various purposes. This is the time on seconds
                      those checks are called.
\end{description}


\begin{figure}
\begin{verbatim}
#latency parameters
cpu_recv_cost 1E-6 1E-7              
cpu_send_cost 1E-6 1E-7
rcp_cost      1E-3 1E-7
scp_cost      1E-6 1E-7
net_cost      1E-6 1E-7


#capacity parameters
# choose one 
cpu_nolimit
#cpu_queue_threshold_number 100000
#cpu_queue_threshold_size   100000


#choose one
scp_nolimit
#scp_queue_threshold_number 100000
#scp_queue_threshold_size   100000

#choose one
rcp_net_nolimit
#rcp_queue_threshold_number 100000
#rcp_queue_threshold_size   100000
#net_queue_threshold_number 100000
#net_queue_threshold_size   100000

#random variations in latency
#choose one
latency-fixed
#latency-rand   0.0001 123456

processor_scale 1.0
periodic_interval 0.1
\end{verbatim}
\caption{A sample configuration file for the simulator}
\label{fig:simconfig}
\end{figure}

\subsection[Command Line Options]{Command Line Options}
\label{command line options}
\index{command line options}

A Charm program accepts the following command line options:
\begin{description}

\item[{\fexec +pN}] Run the program with N processors. The default is 1.
Note that on some nonshared memory machines, e.g., nCUBE/2, the user must
specify the number of processors using the command provided for that
machine (e.g. {\fexec xnc} on the nCUBE/2).
In such cases the {\fexec +p} option is ignored.

%\item[{\fexec +mM}] Run the program with M Kwords of memory per
%processor. The default is 50 Kwords of memory per processor.

%\item[{\fexec +mmM}] Run the program with M Kwords of memory for
%processor 0.

\item[{\fexec +ss}] Print summary statistics about chare creation.  This option
prints the total number of chare creation requests, and the total number of
chare creation requests processed across all processors.

\item[{\fexec +cs}] Print statistics about the number of create chare messages
requested and processed, the number of messages for chares requested and 
processed, and the number of messages for branch office chares requested and
processed, on a per processor basis.  Note that the number of messages 
created and processed for a particular type of message on a given node 
may not be the same, since a message may be processed by a different
processor from the one originating the request.

%\item[{\fexec +mems}] Print the Memory Usage Statistics at the end, including
%the number of memory allocation requests and memory free requests, based on
%the size of the memory allocated or freed.

\item[{\fexec user\_options}] Options that are be interpreted by the user
program may be included after all the system options. 
However, {\fexec user\_options} cannot start with +.
The {\fexec user\_options} will be passed as arguments to the user program 
via the usual {\fcmd argc/argv} construct to the {\fcmd main}\index{main}
entry point of the main chare. 
Charm system options will not appear in {\fcmd argc/argv}.

\end{description}

\subsubsection[Additional Uniprocessor Command Line Options]
{Additional Uniprocessor Command Line Options}
\label{uniprocessor command line options}

The uniprocessor versions can be used to simulate multiple
processors on a single workstation\index{uniprocessor command line
options}.  Any number of processors between 1 and 32 can be simulated by
using the {\fexec +p} option, limited only by the available memory on the
uniprocessor workstation.  By default, the uniprocessor versions handle
a single message from each processor, going in order from processor 0
thru $P-1$ (where $P$ is the number of processors) repeatedly.  
%If the
%user supplies the {\fexec +seed} \index{+seed} command line option
%followed by an 
%integer value, the processors will be accessed in a random (but
%deterministic) order.  {\fexec +seed} is only recognized by the
%uniprocessor version.

\subsubsection[Additional Network Command Line Options]
{Additional Network Command Line Options}
\label{network command line options}

The following {\fexec ++} command line options are available in
the network version\index{network command line options}:
\begin{description}

\item[{\fexec ++debug}] Run each node under gdb in an xterm window, prompting
the user to begin execution.
\index{++debug}

\item[{\fexec ++debug-no-pause}] Run each node under gdb in an xterm window
immediately (i.e. without prompting the user to begin execution).
\index{++debug-no-pause}

\item[{\fexec ++maxrsh}] Maximum number of {\fcmd rsh}'s to run at a
time.
\index{++maxrsh}

\item[{\fexec ++resend-wait}] Timeout before retransmitting datagrams
(in msec).
\index{++resend-wait}

\item[{\fexec ++resend-fail}] Timeout before retransmission fails (in
msec).\index{++resend-fail}
This parameter can help the user kill ``runaway'' processes, which may not
be killed otherwise when the user interrupts the program before it 
completes execution.
Currently a bug exists in the network version that may cause programs to
terminate prematurely if this value is set too low and {\fexec scanf} 
operations are being performed.

\item[{\fexec ++nodesfile}] File containing list of nodes.
\index{++nodesfile}\index{.nodes}\index{nodes file}

\end{description}

If using the {\fexec ++debug} option, the user must ensure the
following:
\index{++debug}
\begin{enumerate}

\item {\fexec xterm}, {\fexec xdpyinfo},  and {\fexec gdb} must be in
the user's path.

\item The path must be set in the {\fexec .cshrc} file, not the {\fexec .login}
file, because {\fexec rsh} does not run the {\fexec .login} file. 

\item The nodes must be authorized to create windows on the host machine (see
man pages for {\fexec xhost} and {\fexec xauth}).

\end{enumerate}
