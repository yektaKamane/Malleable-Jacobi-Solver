\chapter{Initialization and Completion}

The program utilizing Converse begins executing at {\tt main}, like
any other C program.  The initialization process is somewhat
complicated by the fact that vendors don't agree about which
processors should execute main.  On some machines, every processor
executes {\tt main}.  On others, only one processor executes {\tt
main}.  All processors which don't execute {\tt main} are asleep when
the program begins.  The function ConverseInit is used to start the
converse system, and to wake up the sleeping processors:

\function{typedef void (*CmiStartFn)(int argc, char **argv);}
\function{void ConverseInit(int argc, char *argv[], CmiStartFn fn, int usched, int initret)}
\index{ConverseInit}
\desc{This function starts up the Converse system.  It can execute
in one of several modes, described below.

Normal Mode: {\tt usched=0, initret=0}

When you run your program, some of the processors automatically invoke
main, others remain asleep.  All processors which automatically
invoked {\tt main} must must call ConverseInit.  This initializes the
entire Converse system.  Converse then initiates, on {\em all}
processors, the execution of the user-supplied initialization function
{\tt fn(argc, argv)} followed by the Converse scheduler.  Once the
scheduler exits on all processors, the Converse system shuts down, and
your program terminates.  Note that in this case, ConverseInit never
returns.  The user is not allowed to call the Converse scheduler
manually.

ConverseInit Returns Mode: {\tt initret=1}

This option is used when you want ConverseInit to return.  All
processors which automatically invoked {\tt main} must call
ConverseInit.  This initializes the entire Converse System.  On all
processors which {\em did not} automatically invoke main, Converse
initiates the user-supplied initialization function {\tt fn(argc,
argv)} followed by the Converse scheduler.  Meanwhile, on those
processors which {\em did} automatically invoke main, ConverseInit
returns.  Shutdown is initiated when the processors that {\em did}
automatically invoke main call ConverseExit, and when the other
processors exit the scheduler.  This option is not supported
by the sim version.

User Calls Scheduler Mode: {\tt usched=1}

This is how the user initializes charm if he wants to call the
Converse scheduler manually.  It is assumed that the user will call
the scheduler from inside the initialization function.  Thus,
ConverseInit will not automatically execute the scheduler for you.
This mode can be combined with ConverseInit returns mode.

\function{void ConverseExit(void)}
\index{ConverseExit}
\desc{This function is only used in ConverseInit returns mode, see
above.}

