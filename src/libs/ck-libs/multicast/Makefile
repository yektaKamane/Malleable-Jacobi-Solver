CDIR :=../../../..
INCDIR:=$(CDIR)/include
CHARMC:=$(CDIR)/bin/charmc $(OPTS)

LIB := libmoduleCkMulticast.a
LIBOBJ := ckmulticast.o

HEADERS := $(INCDIR)/CkMulticast.decl.h \
          $(INCDIR)/CkMulticast.def.h \
          $(INCDIR)/ckmulticast.h
LIBDEST :=  $(CDIR)/lib/$(LIB)

CIFILES := ckmulticast.ci

all: $(LIBDEST) $(HEADERS)

$(INCDIR)/%: %
	cp $< $@

#$(HEADERS): CkMulticast.decl.h ckmulticast.h 
#	/bin/cp CkMulticast.decl.h $(CDIR)/include
#	/bin/cp CkMulticast.def.h $(CDIR)/include
#	/bin/cp ckmulticast.h $(CDIR)/include

$(LIBDEST): $(LIBOBJ)
	$(CHARMC) -o $(LIBDEST) $(LIBOBJ) 

CkMulticast.def.h: CkMulticast.decl.h

CkMulticast.decl.h : ckmulticast.ci $(CDIR)/bin/charmxi
	$(CHARMC) -c ckmulticast.ci

clean:
	rm -f conv-host *.o *.decl.h *.def.h core  $(LIB)

include Make.depends

DEPENDFILE = Make.depends

depends:  $(CIFILES)
	echo "Creating " $(DEPENDFILE) " ..."; 	\
	if [ -f $(DEPENDFILE) ]; then \
           /bin/cp -f $(DEPENDFILE) $(DEPENDFILE).old; \
        fi; \
	echo '#generated by make depends' > $(DEPENDFILE); \
        for i in $(LIBOBJ) ; do \
	      SRCFILE=`basename $$i .o`.C ; \
              echo "checking dependencies for $$i : $$SRCFILE" ; \
              g++ -MM -Wno-deprecated -I$(CDIR)/tmp $$SRCFILE >> $(DEPENDFILE); \
              echo '	$$(CHARMC) -I$(CDIR)/tmp -o '$$i $$SRCFILE >> $(DEPENDFILE) ; \
        done; 

