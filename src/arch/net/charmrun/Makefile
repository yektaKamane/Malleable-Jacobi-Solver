BIN=../../bin
CHARMC=$(BIN)/charmc $(OPTS)

SHELL=/bin/sh

INCLUDED=../conv-mach.h ../conv-mach-opt.h \
	../ccs-server.c ../ccs-server.h ../ccs-auth.c ../ccs-auth.h \
	../sockRoutines.c ../sockRoutines.h

all: charmrun-notify charmd charmd_faceless

charmrun-silent: charmrun.c $(INCLUDED)
	$(CHARMC) -c -seq -DSILENT charmrun.c -o charmrun-silent.o
	$(CHARMC) -cp $(BIN) -seq -o charmrun-silent charmrun-silent.o
	(cd ..; CHARMINC=.; . ./conv-config.sh; cp ../bin/charmrun-silent$$CMK_POST_EXE ../bin/charmrun$$CMK_POST_EXE)

charmrun-notify: charmrun.c $(INCLUDED)
	$(CHARMC) -c -seq -DNOTIFY charmrun.c
	$(CHARMC) -cp $(BIN) -seq -o charmrun-notify charmrun.o
	(cd ..; CHARMINC=.; . ./conv-config.sh; cp ../bin/charmrun-notify$$CMK_POST_EXE ../bin/charmrun$$CMK_POST_EXE)

charmd-both : daemon.c daemon.h ../sockRoutines-seq.o
	$(CHARMC) -c daemon.c -o daemon.o
	$(CHARMC) -cp $(BIN) -seq daemon.o ../sockRoutines-seq.o -o charmd
	$(CHARMC) -DFACELESS -c daemon.c -o daemon.o
	$(CHARMC) -cp $(BIN) -seq -DFACELESS daemon.o ../sockRoutines-seq.o -o charmd_faceless;

charmd: charmd-both
# charmd: daemon.c daemon.h ../sockRoutines-seq.o
# 	$(CHARMC) -c daemon.c -o daemon.o
# 	$(CHARMC) -cp $(BIN) -seq daemon.o ../sockRoutines-seq.o -o charmd

charmd_faceless: charmd-both
# charmd_faceless: daemon.c daemon.h ../sockRoutines-seq.o
# 	$(CHARMC) -DFACELESS -c daemon.c -o daemon-faceless.o
# 	$(CHARMC) -cp $(BIN) -seq -DFACELESS daemon-faceless.o ../sockRoutines-seq.o -o charmd_faceless;

clean:
	rm -f *.o charmrun charmrun-notify charmrun-silent
	rm -f charmd charmd_faceless
